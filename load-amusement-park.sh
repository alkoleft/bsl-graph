#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–ü–∞—Ä–∫–æ–º–ê—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤" —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

echo "üé¢ === –ó–ê–ì–†–£–ó–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò '–£–ü–†–ê–í–õ–ï–ù–ò–ï–ü–ê–†–ö–û–ú–ê–¢–¢–†–ê–ö–¶–ò–û–ù–û–í' –ß–ï–†–ï–ó –ö–û–ù–°–û–õ–¨–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ==="
echo

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Nebula Graph –∑–∞–ø—É—â–µ–Ω
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Nebula Graph..."
if docker-compose -f docker-compose-lite.yaml ps | grep -q "Up"; then
    echo "‚úÖ Nebula Graph –∑–∞–ø—É—â–µ–Ω"
else
    echo "‚ùå Nebula Graph –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º Nebula Graph..."
    docker-compose -f docker-compose-lite.yaml up -d
    
    echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
    sleep 15
    
    if docker-compose -f docker-compose-lite.yaml ps | grep -q "Up"; then
        echo "‚úÖ Nebula Graph —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω"
    else
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å Nebula Graph"
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: docker-compose -f docker-compose-lite.yaml logs"
        exit 1
    fi
fi

echo

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
CONFIG_PATH="/home/alko/develop/open-source/amusement-park-vibe/–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–ü–∞—Ä–∫–æ–º–ê—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤/src"
if [ -d "$CONFIG_PATH" ]; then
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞: $CONFIG_PATH"
else
    echo "‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: $CONFIG_PATH"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π"
    exit 1
fi

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
if ./gradlew build -x test; then
    echo "‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

echo

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Nebula Graph
echo "üîó –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Nebula Graph..."
echo

if java -jar build/libs/app.jar --test-nebula; then
    echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Nebula Graph —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Nebula Graph"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
    exit 1
fi

echo

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
echo "üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–ü–∞—Ä–∫–æ–º–ê—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤'..."
echo "–ü—É—Ç—å: $CONFIG_PATH"
echo

if java -jar build/libs/app.jar "$CONFIG_PATH"; then
    echo
    echo "üéâ === –ó–ê–ì–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û ==="
    echo
    echo "üìä –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≥—Ä–∞—Ñ–∞..."
    echo
    java -jar build/libs/app.jar --stats
    
    echo
    echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ Nebula Graph!"
    echo
    echo "üí° –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:"
    echo "   ‚Ä¢ –í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –≥—Ä–∞—Ñ—É –∑–Ω–∞–Ω–∏–π"
    echo "   ‚Ä¢ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
    echo "   ‚Ä¢ –ò—Å–∫–∞—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"
    echo "   ‚Ä¢ –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"
    
else
    echo
    echo "‚ùå === –ó–ê–ì–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –° –û–®–ò–ë–ö–ê–ú–ò ==="
    echo
    echo "üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
    echo "   ‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Nebula Graph"
    echo "   ‚Ä¢ –û—à–∏–±–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
    echo "   ‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤"
    echo
    echo "üìã –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:"
    echo "   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: docker-compose -f docker-compose-lite.yaml logs"
    echo "   ‚Ä¢ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: java -jar build/libs/app.jar --test-nebula"
    echo "   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
fi

echo
echo "üèÅ === –°–ö–†–ò–ü–¢ –ó–ê–í–ï–†–®–ï–ù ==="
