# Руководство по тестированию конфигурации "УправлениеПаркомАттракционов"

## Обзор

Созданы специализированные тесты для загрузки реальной конфигурации 1С "УправлениеПаркомАттракционов" в Nebula Graph. Эта конфигурация содержит множество объектов метаданных и является отличным примером для демонстрации возможностей системы.

## Структура конфигурации

Конфигурация "УправлениеПаркомАттракционов" содержит:

- **46 справочников** - справочники аттракционов, билетов, посетителей и др.
- **9 документов** - документы продажи билетов, обслуживания аттракционов и др.
- **50 перечислений** - различные типы и статусы
- **77 констант** - настройки системы
- **279 общих модулей** - бизнес-логика
- **84 регистра сведений** - накопление данных
- **31 отчет** - аналитические отчеты
- **И множество других объектов** - роли, подсистемы, формы и т.д.

## Созданные тесты

### 1. AmusementParkConfigurationTest

**Файл:** `src/test/kotlin/ru/alkoleft/context/infrastructure/metadata/AmusementParkConfigurationTest.kt`

**Описание:** Комплексный тест с детальным анализом загруженных данных.

**Тесты:**
- `загружает конфигурацию УправлениеПаркомАттракционов в Nebula Graph` - основная загрузка
- `тестирует поиск конкретных объектов конфигурации` - поиск по имени и типу
- `проверяет производительность загрузки` - анализ времени выполнения
- `проверяет целостность данных в графе` - валидация загруженных данных

### 2. ConsoleAmusementParkTest

**Файл:** `src/test/kotlin/ru/alkoleft/context/infrastructure/metadata/ConsoleAmusementParkTest.kt`

**Описание:** Упрощенный тест для демонстрации с красивым выводом.

**Тест:**
- `демонстрация загрузки конфигурации УправлениеПаркомАттракционов` - демо с эмодзи и детальной статистикой

### 3. Скрипты для автоматизации

**Файл:** `test-amusement-park.sh`
- Автоматический запуск тестов через Gradle
- Проверка статуса Nebula Graph
- Детальная диагностика

**Файл:** `load-amusement-park.sh`
- Загрузка через консольное приложение
- Пошаговая проверка всех компонентов
- Красивый вывод результатов

## Способы запуска тестов

### 1. Через Gradle (рекомендуется)

```bash
# Запуск основного теста
./gradlew test --tests "AmusementParkConfigurationTest"

# Запуск демо-теста
./gradlew test --tests "ConsoleAmusementParkTest"

# Запуск всех тестов
./gradlew test
```

### 2. Через автоматизированные скрипты

```bash
# Тест через Gradle
./test-amusement-park.sh

# Загрузка через консольное приложение
./load-amusement-park.sh
```

### 3. Через консольное приложение напрямую

```bash
# Сборка проекта
./gradlew build -x test

# Запуск Nebula Graph
docker-compose -f docker-compose-lite.yaml up -d

# Загрузка конфигурации
java -jar build/libs/app.jar /home/alko/develop/open-source/amusement-park-vibe/УправлениеПаркомАттракционов/src

# Просмотр статистики
java -jar build/libs/app.jar --stats
```

## Предварительные требования

### 1. Запуск Nebula Graph

```bash
# Запуск через Docker Compose
docker-compose -f docker-compose-lite.yaml up -d

# Проверка статуса
docker-compose -f docker-compose-lite.yaml ps

# Просмотр логов (при необходимости)
docker-compose -f docker-compose-lite.yaml logs
```

### 2. Проверка доступности конфигурации

```bash
# Проверка существования пути
ls -la /home/alko/develop/open-source/amusement-park-vibe/УправлениеПаркомАттракционов/src

# Просмотр структуры
tree /home/alko/develop/open-source/amusement-park-vibe/УправлениеПаркомАттракционов/src -L 2
```

### 3. Настройка окружения

Убедитесь, что в `application.yml` настроены правильные параметры подключения к Nebula Graph:

```yaml
nebula:
  addresses:
    - host: localhost
      port: 9669
  username: root
  password: nebula
  space: amusement-park
```

## Ожидаемые результаты

### При успешной загрузке:

- ✅ Загружено 500+ узлов (объекты метаданных)
- ✅ Загружено 1000+ рёбер (связи между объектами)
- ✅ Время загрузки: 5-30 секунд (зависит от производительности)
- ✅ Все основные типы объектов присутствуют
- ✅ Связи между объектами корректны

### Статистика по типам объектов:

- Configuration: 1 (корневая конфигурация)
- Catalog: 46 (справочники)
- Document: 9 (документы)
- Enum: 50 (перечисления)
- Constant: 77 (константы)
- Module: 279 (модули)
- Register: 84 (регистры)
- Report: 31 (отчеты)
- И другие типы объектов

## Диагностика проблем

### 1. Nebula Graph не запускается

```bash
# Проверка статуса Docker
docker ps

# Перезапуск сервисов
docker-compose -f docker-compose-lite.yaml down
docker-compose -f docker-compose-lite.yaml up -d

# Просмотр логов
docker-compose -f docker-compose-lite.yaml logs graphd
```

### 2. Ошибки подключения

```bash
# Тестирование подключения
java -jar build/libs/app.jar --test-nebula

# Проверка портов
netstat -tlnp | grep 9669
```

### 3. Ошибки загрузки конфигурации

```bash
# Проверка прав доступа
ls -la /home/alko/develop/open-source/amusement-park-vibe/УправлениеПаркомАттракционов/src

# Проверка структуры
find /home/alko/develop/open-source/amusement-park-vibe/УправлениеПаркомАттракционов/src -name "*.xml" | head -10
```

### 4. Медленная производительность

- Увеличьте размер пула соединений в `application.yml`
- Проверьте доступность памяти для Nebula Graph
- Рассмотрите увеличение таймаутов

## Анализ результатов

### 1. Просмотр загруженных данных

```bash
# Статистика графа
java -jar build/libs/app.jar --stats

# Поиск конкретных объектов (через nGQL)
# Подключение к Nebula Graph через консоль
docker run --rm -ti --network host vesoft/nebula-console:v3.8.0 -addr 127.0.0.1 -port 9669 -u root -p nebula
```

### 2. Примеры nGQL запросов

```ngql
# Все справочники
MATCH (n:Catalog) RETURN n.name, n.uuid LIMIT 10;

# Все документы
MATCH (n:Document) RETURN n.name, n.uuid LIMIT 10;

# Связи конфигурации
MATCH (c:Configuration)-[r]->(n) 
RETURN c.name, type(r), n.name LIMIT 10;

# Статистика по типам
MATCH (n) 
RETURN labels(n)[0] as nodeType, count(n) as count 
ORDER BY count DESC;
```

## Расширение тестов

### 1. Добавление новых проверок

Можно расширить тесты, добавив:
- Проверку конкретных объектов по именам
- Валидацию связей между объектами
- Тестирование поиска по различным критериям
- Проверку производительности различных операций

### 2. Тестирование других конфигураций

Скрипты можно адаптировать для других конфигураций:
- Изменить путь к конфигурации
- Настроить ожидаемые результаты
- Добавить специфичные для конфигурации проверки

## Заключение

Созданные тесты предоставляют:

- ✅ Полную демонстрацию возможностей системы
- ✅ Автоматизированную проверку всех компонентов
- ✅ Детальную диагностику проблем
- ✅ Удобные скрипты для быстрого запуска
- ✅ Красивый вывод с эмодзи и форматированием

Тесты готовы к использованию и могут служить основой для дальнейшего развития системы анализа метаданных 1С.
